# flex_assignment

## Data Modeling
Assumptions: the provided data resembles a snapshot front end cache of aggregates rather than raw transactions from an application back end that are the typical source data I am used to working with. This leaves me to make some inferences in the modeling, but I think it's safe to say there must be something like a back end database or API that would return something like what I have modeled in fact_transactions, even though you did not give me anything directly like that. I am further making the assumption that accounts have 1:1 owners (customers) and that the front end cache is coming from a view that is something like agg_daily_account_balance, which is a rollup of fact_transactions partitioned on account id, with rolling window sums.

Out of scope: currency? if the data cache had indicated that amounts were not all in one currency, I would have included dim_currencies, fact_currency_rates, and some intermediate modeling to project to a default top level currency for agg_daily_account_balance

Modeling choices: since the nested structure of account types seems like something that may be a SCD, I chose not to flatten it and make a self-referential dim_account_type table where the full heirarchy can be extracted with a recursive CTE. In practice this is not business-user friendly inside BI tools so depending on how else this is getting used I might make an alternative flat version of dim_account_type with rows for bottom-level types only and fields for parent categories up to fixed depth (3 works here?) but that has the tradeoff of being brittle and not likely to last.

## Data Validation
I provided a Jupyter notebook to display the output of a recursive validation function that checks if the declared values match the sum of immediate child values, proceeding down the heirarchy, and flags them as failed if the declared and derived values don't match. There was a single mismatch found: Current Liabilities has a declared value of 1014525.75 and a derived value of 937527.65. From what is provided it is impossible to investigate further, other than to say that the children pass validation so it seems likely that an additional child of Current Liabilities was ommitted. I would need the fact_transactions model rows to be sure.

I have encountered a similar validation problem at my current company without the ragged nesting wrinkle, and the way I went about validation with dbt rather than Python looked very different. The Vinovest back end generates its own version of the roll up cache at a fixed cadence, which is treated with skepticism and ELT'd separately from the Vinovest equivalent of fact_transactions, which is more trustworthy. A dbt equivalent of agg_daily_account_balance is derived from fact_transactions, and then the model of the cache and the dbt derivation can be compared with custom tests in dbt (https://github.com/calogica/dbt-expectations/tree/0.10.4/#expect_table_aggregation_to_equal_other_table)
